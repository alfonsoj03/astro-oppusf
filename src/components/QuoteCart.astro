---
import { X, Minus, Plus } from "lucide-astro";

interface CartItem {
    id: string;
    name: string;
    code: string;
    quantity: number;
    lumens: string;
    warranty: string;
    image: string;
}

const cartItems: CartItem[] = [
    {
        id: "1",
        name: "Highbay VAL Bracket 63W-83",
        code: "T14381",
        quantity: 450,
        lumens: "8,190 lm",
        warranty: "5 años",
        image: "https://images.unsplash.com/photo-1565814329452-e1efa11c5b89?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&q=80&w=200",
    },
    {
        id: "2",
        name: "Panel LED Square 40W",
        code: "T14382",
        quantity: 1200,
        lumens: "4,800 lm",
        warranty: "3 años",
        image: "https://images.unsplash.com/photo-1541961017774-22349e4a1262?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&q=80&w=200",
    },
    {
        id: "3",
        name: "Luminaria Solar Street 80W",
        code: "T14383",
        quantity: 450,
        lumens: "10,400 lm",
        warranty: "5 años",
        image: "https://images.unsplash.com/photo-1565814636199-ae8133055c1c?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&q=80&w=200",
    },
];
---

<section class="bg-white pb-12 pt-32">
    <div class="max-w-7xl mx-auto px-6">

        {/* Breadcrumb */}
        <div
            class="flex items-center gap-3 text-zinc-500 text-xs uppercase tracking-widest mb-6"
        >
            <span>Inicio</span>
            <span class="text-[#FF8351]">/</span>
            <span class="text-[#FF8351]">Productos</span>
        </div>

        {/* Header: Shopping Cart Title */}
        <div class="mb-8 flex items-end justify-between">
            <div>
                <h2
                    class="text-4xl font-bold tracking-tight text-black leading-none mb-2"
                >
                    Solicitar Cotización
                </h2>
                <div class="h-1 w-16 bg-[#FF8351]"></div>
            </div>
            <div class="text-zinc-500 text-sm max-w-xs text-right pb-2 hidden md:block">
                Haznos llegar tu cotización escribiendo un mensaje en el formulario
                de abajo.
            </div>
        </div>

        {/* Cart Items */}
        <div class="space-y-4 mb-12" id="cart-items-container">
            {
                cartItems.map((item) => (
                    <div
                        class="cart-item bg-zinc-50 border border-zinc-200 p-6 flex items-center gap-8 hover:border-[#FF8351]/50 transition-all duration-300"
                        data-id={item.id}
                    >
                        {/* Product Image */}
                        <div class="w-20 h-20 bg-white rounded overflow-hidden flex-shrink-0">
                            <img
                                src={item.image}
                                alt={item.name}
                                class="w-full h-full object-cover"
                            />
                        </div>

                        {/* Product Name & Code */}
                        <div class="flex-1">
                            <h3 class="text-black font-bold uppercase tracking-wide leading-tight mb-1">
                                {item.name}
                            </h3>
                            <p class="text-xs text-zinc-400">{item.code}</p>
                        </div>

                        {/* Lumens */}
                        <div class="min-w-[100px]">
                            <p class="text-xs text-zinc-400 mb-1">
                                Flujo luminoso
                            </p>
                            <p class="text-black font-bold text-sm">
                                {item.lumens}
                            </p>
                        </div>

                        {/* Warranty */}
                        <div class="min-w-[100px]">
                            <p class="text-xs text-zinc-400 mb-1">Garantía</p>
                            <p class="text-black font-bold text-sm">
                                {item.warranty}
                            </p>
                        </div>

                        {/* Quantity Controls */}
                        <div class="flex items-center gap-4">
                            <button
                                class="decrease-qty w-8 h-8 rounded-full border border-zinc-300 hover:border-[#FF8351] flex items-center justify-center transition-colors text-zinc-600 hover:text-[#FF8351]"
                                aria-label="Disminuir cantidad"
                            >
                                <Minus class="w-4 h-4" />
                            </button>
                            <span class="qty-display text-black min-w-[40px] text-center">
                                {item.quantity}
                            </span>
                            <button
                                class="increase-qty w-8 h-8 rounded-full border border-zinc-300 hover:border-[#FF8351] flex items-center justify-center transition-colors text-zinc-600 hover:text-[#FF8351]"
                                aria-label="Aumentar cantidad"
                            >
                                <Plus class="w-4 h-4" />
                            </button>
                        </div>

                        {/* Remove Button */}
                        <button
                            class="remove-item w-8 h-8 rounded-full border border-zinc-300 hover:border-[#FF8351] flex items-center justify-center transition-colors text-zinc-400 hover:text-[#FF8351]"
                            aria-label="Eliminar producto"
                        >
                            <X class="w-4 h-4" />
                        </button>
                    </div>
                ))
            }
        </div>

        {/* Contact Form */}
        <div>

            <form id="quote-form" class="bg-zinc-50 p-8">
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    {/* Nombre */}
                    <div>
                        <label
                            for="name"
                            class="block text-sm text-zinc-600 mb-2"
                        >
                            Nombre
                        </label>
                        <input
                            type="text"
                            id="name"
                            name="name"
                            placeholder="Tu nombre completo"
                            required
                            class="w-full px-4 py-3 bg-white border border-zinc-200 rounded text-black placeholder-zinc-400 focus:outline-none focus:border-[#FF8351] transition-colors"
                        />
                    </div>

                    {/* Email */}
                    <div>
                        <label
                            for="email"
                            class="block text-sm text-zinc-600 mb-2"
                        >
                            Email
                        </label>
                        <input
                            type="email"
                            id="email"
                            name="email"
                            placeholder="nombre@empresa.com"
                            required
                            class="w-full px-4 py-3 bg-white border border-zinc-200 rounded text-black placeholder-zinc-400 focus:outline-none focus:border-[#FF8351] transition-colors"
                        />
                    </div>

                    {/* Teléfono */}
                    <div>
                        <label
                            for="phone"
                            class="block text-sm text-zinc-600 mb-2"
                        >
                            Teléfono de Contacto
                        </label>
                        <input
                            type="tel"
                            id="phone"
                            name="phone"
                            placeholder="81 1234 5678"
                            required
                            class="w-full px-4 py-3 bg-white border border-zinc-200 rounded text-black placeholder-zinc-400 focus:outline-none focus:border-[#FF8351] transition-colors"
                        />
                    </div>

                    {/* País */}
                    <div>
                        <label
                            for="country"
                            class="block text-sm text-zinc-600 mb-2"
                        >
                            País de Contacto
                        </label>
                        <select
                            id="country"
                            name="country"
                            required
                            class="w-full px-4 py-3 bg-white border border-zinc-200 rounded text-black focus:outline-none focus:border-[#FF8351] transition-colors"
                        >
                            <option value="">Selecciona tu país</option>
                            <option value="MX">México</option>
                            <option value="CO">Colombia</option>
                            <option value="US">Estados Unidos</option>
                            <option value="CA">Canadá</option>
                            <option value="other">Otro</option>
                        </select>
                    </div>
                </div>

                {/* Campo condicional para especificar país */}
                <div id="other-country-container" class="hidden mb-6">
                    <label
                        for="other-country"
                        class="block text-sm text-zinc-600 mb-2"
                    >
                        Especifica tu país
                    </label>
                    <input
                        type="text"
                        id="other-country"
                        name="other-country"
                        placeholder="Escribe tu país"
                        class="w-full px-4 py-3 bg-white border border-zinc-200 rounded text-black placeholder-zinc-400 focus:outline-none focus:border-[#FF8351] transition-colors"
                    />
                </div>

                {/* Mensaje */}
                <div class="mb-2">
                    <label
                        for="message"
                        class="block text-sm text-zinc-600 mb-2"
                    >
                        Mensaje
                    </label>
                    <textarea
                        id="message"
                        name="message"
                        rows="6"
                        required
                        class="w-full px-4 py-3 bg-white border border-zinc-200 rounded text-black placeholder-zinc-400 focus:outline-none focus:border-[#FF8351] transition-colors resize-none"
                        >Quiero hacer una cotización con respecto a los productos en mi carrito...</textarea
                    >
                </div>

            </form>

            <div class="flex flex-col md:flex-row justify-between items-center mt-8 gap-4">
                <div class="flex items-center gap-2 text-zinc-400 text-sm">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="lucide lucide-lock"
                        ><rect width="18" height="11" x="3" y="11" rx="2" ry="2"
                        ></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg
                    >
                    <span>Tus datos están protegidos</span>
                </div>
                <button
                    type="submit"
                    form="quote-form"
                    class="w-full md:w-auto px-12 py-3 bg-[#FF8351] text-white font-bold uppercase tracking-wider text-sm hover:bg-[#ff6f38] transition-colors"
                >
                    Enviar Cotización
                </button>
            </div>
        </div>
    </div>
</section>

<script>
    const cartContainer = document.getElementById("cart-items-container");
    const cartCount = document.getElementById("cart-count");

    function updateCartCount() {
        if (!cartContainer || !cartCount) return;
        const count = cartContainer.querySelectorAll(".cart-item").length;
        cartCount.textContent = count.toString();
    }

    if (cartContainer) {
        cartContainer.addEventListener("click", (e) => {
            const target = e.target as HTMLElement;
            const itemRow = target.closest(".cart-item") as HTMLElement;

            if (!itemRow) return;

            const qtyDisplay = itemRow.querySelector(".qty-display");
            let currentQty = parseInt(qtyDisplay?.textContent || "0");

            // Increase Quantity
            if (target.closest(".increase-qty")) {
                currentQty++;
                if (qtyDisplay) qtyDisplay.textContent = currentQty.toString();
            }

            // Decrease Quantity
            if (target.closest(".decrease-qty")) {
                if (currentQty > 1) {
                    currentQty--;
                    if (qtyDisplay)
                        qtyDisplay.textContent = currentQty.toString();
                }
            }

            // Remove Item
            if (target.closest(".remove-item")) {
                itemRow.style.opacity = "0";
                itemRow.style.transform = "translateX(-20px)";
                setTimeout(() => {
                    itemRow.remove();
                    updateCartCount();
                }, 300);
            }
        });
    }

    // Form handling
    const form = document.getElementById("quote-form") as HTMLFormElement;
    if (form) {
        form.addEventListener("submit", (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            console.log("Form submitted:", data);
            alert("¡Cotización enviada! (Simulación)");
        });
    }

    // Country selection handler
    const countrySelect = document.getElementById("country") as HTMLSelectElement;
    const otherCountryContainer = document.getElementById("other-country-container");
    const otherCountryInput = document.getElementById("other-country") as HTMLInputElement;

    if (countrySelect && otherCountryContainer && otherCountryInput) {
        countrySelect.addEventListener("change", (e) => {
            const target = e.target as HTMLSelectElement;
            if (target.value === "other") {
                otherCountryContainer.classList.remove("hidden");
                otherCountryInput.required = true;
            } else {
                otherCountryContainer.classList.add("hidden");
                otherCountryInput.required = false;
                otherCountryInput.value = "";
            }
        });
    }
</script>