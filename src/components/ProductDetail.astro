---
import { Download, Check, ChevronLeft, ChevronRight } from "lucide-astro";

interface Props {
    category: string;
    title: string;
    seriesTitle: string;
    seriesSubtitle: string;
    description: string;
    previousModel?: string;
    image: string;
    versions: { id: string; name: string; gtin: string }[];
    specifications: { label: string; value: string }[];
    technicalDescription: string[];
    technicalImages: { title: string; image: string }[];
}

const {
    category,
    title,
    seriesTitle,
    seriesSubtitle,
    description,
    previousModel,
    image,
    specifications,
    technicalDescription,
    technicalImages,
} = Astro.props;

const allImages = [
    { title: "Producto Principal", image: image },
    ...technicalImages,
];
---

<section class="bg-white pt-32 pb-12">
    <div class="max-w-7xl mx-auto px-6">
        <div class="grid md:grid-cols-2 gap-12 mb-16">
            {/* Galería de Imágenes */}
            <div class="flex flex-col gap-4">
                {/* Imagen Principal */}
                <div
                    class="bg-gray-50 rounded-lg relative overflow-hidden group"
                >
                    {
                        /* Imagen Espaciadora (Define el tamaño basado en la primera imagen) */
                    }
                    <img
                        src={allImages[0].image}
                        alt=""
                        class="w-full h-auto invisible relative z-0"
                        aria-hidden="true"
                    />

                    {/* Tag del título */}
                    <div
                        class="absolute top-4 left-1/2 -translate-x-1/2 bg-white/90 backdrop-blur-sm px-4 py-1 rounded-full shadow-sm border border-gray-100 z-20"
                    >
                        <span
                            id="gallery-title"
                            class="text-xs font-bold uppercase tracking-wider text-gray-800"
                        >
                            {allImages[0].title}
                        </span>
                    </div>

                    {/* Botón Anterior */}
                    <button
                        id="prev-btn"
                        class="absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-black p-2 rounded-full shadow-md opacity-0 group-hover:opacity-100 transition-all duration-300 z-30"
                        aria-label="Imagen anterior"
                    >
                        <ChevronLeft class="w-6 h-6" />
                    </button>

                    {/* Botón Siguiente */}
                    <button
                        id="next-btn"
                        class="absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-black p-2 rounded-full shadow-md opacity-0 group-hover:opacity-100 transition-all duration-300 z-30"
                        aria-label="Siguiente imagen"
                    >
                        <ChevronRight class="w-6 h-6" />
                    </button>

                    <img
                        id="main-image"
                        src={allImages[0].image}
                        alt={allImages[0].title}
                        class="absolute inset-0 w-full h-full object-cover transition-opacity duration-300 z-10"
                    />
                </div>

                {/* Miniaturas */}
                <div class="grid grid-cols-5 gap-4">
                    {
                        allImages.map((img, index) => (
                            <button
                                class:list={[
                                    "bg-gray-50 rounded-lg overflow-hidden aspect-square border-2 transition-all duration-200 gallery-thumb relative",
                                    index === 0
                                        ? "border-[#FF8351] opacity-100"
                                        : "border-transparent opacity-50 hover:opacity-100",
                                ]}
                                data-index={index}
                                data-image={img.image}
                                data-title={img.title}
                                aria-label={`Ver ${img.title}`}
                            >
                                <img
                                    src={img.image}
                                    alt={img.title}
                                    class="w-full h-full object-cover"
                                />
                            </button>
                        ))
                    }
                </div>
            </div>

            {/* Información del producto */}
            <div class="flex flex-col">
                {/* Categoría */}
                <p class="text-sm tracking-wider text-gray-600 mb-4">
                    {category}
                </p>

                {/* Título del producto */}
                <h1 class="text-[#FF8351] mb-8 text-4xl font-bold">
                    {title}
                </h1>

                {/* Descripción del producto */}
                <div class="mb-10">
                    <h2 class="mb-3 text-2xl font-bold">
                        {seriesTitle}
                    </h2>
                    <p class="text-sm text-gray-500 mb-6">
                        {seriesSubtitle}
                    </p>
                    <p class="text-gray-700 leading-relaxed text-base mb-6">
                        {description}
                    </p>
                    {
                        previousModel && (
                            <p class="text-sm">
                                <span class="text-[#1e3a8a]">
                                    Anteriormente:
                                </span>{" "}
                                <span class="text-gray-700">
                                    {previousModel}
                                </span>
                            </p>
                        )
                    }
                </div>

                {/* Botón Descargar hoja de datos */}
                <button
                    class="w-full mb-4 px-6 py-3 border-2 border-[#FF8351] text-[#FF8351] rounded-lg hover:bg-[#FF8351] hover:text-white transition-colors flex items-center justify-center gap-2 font-bold"
                >
                    <span>DESCARGAR HOJA DE DATOS</span>
                    <Download class="w-5 h-5" />
                </button>

                {/* Botón Contactar ventas */}
                <button
                    class="w-full px-6 py-4 bg-[#FF8351] text-white rounded-lg hover:bg-[#e6744a] transition-colors font-bold"
                >
                    CONTACTAR VENTAS
                </button>
            </div>
        </div>

        {/* Sección de Especificaciones con tabla */}
        <div class="mb-12">
            <h2 class="mb-6 text-2xl font-bold">Información técnica</h2>
            <div class="space-y-4 mb-12">
                {
                    technicalDescription.map((paragraph) => (
                        <p class="text-gray-700 leading-relaxed">{paragraph}</p>
                    ))
                }
            </div>
        </div>

        {/* Sección de Información técnica */}
        <div class="mb-12 max-w-xl">
            <h2 class="mb-6 max-w-xl">Especificaciones</h2>
            <div class="border-t border-gray-200">
                {
                    specifications.map((spec) => (
                        <div class="grid grid-cols-2 py-4 border-b border-gray-200">
                            <div class="text-gray-600">{spec.label}</div>
                            <div class="text-gray-900 text-right">
                                {spec.value}
                            </div>
                        </div>
                    ))
                }
            </div>
        </div>
    </div>
</section>

<script>
    const mainImage = document.getElementById("main-image") as HTMLImageElement;
    const galleryTitle = document.getElementById("gallery-title");
    const thumbs = document.querySelectorAll(".gallery-thumb");
    const prevBtn = document.getElementById("prev-btn");
    const nextBtn = document.getElementById("next-btn");

    let currentIndex = 0;
    const totalImages = thumbs.length;

    function updateGallery(index: number) {
        const thumb = thumbs[index] as HTMLElement;
        const newImage = thumb.getAttribute("data-image");
        const newTitle = thumb.getAttribute("data-title");

        if (mainImage && newImage) {
            mainImage.style.opacity = "0";
            setTimeout(() => {
                mainImage.src = newImage;
                mainImage.style.opacity = "1";
            }, 150);
        }

        if (galleryTitle && newTitle) {
            galleryTitle.textContent = newTitle;
        }

        thumbs.forEach((t) => {
            t.classList.remove("border-[#FF8351]", "opacity-100");
            t.classList.add("border-transparent", "opacity-50");
        });
        thumb.classList.remove("border-transparent", "opacity-50");
        thumb.classList.add("border-[#FF8351]", "opacity-100");

        currentIndex = index;
    }

    thumbs.forEach((thumb, index) => {
        thumb.addEventListener("click", () => {
            updateGallery(index);
        });
    });

    prevBtn?.addEventListener("click", () => {
        const newIndex = (currentIndex - 1 + totalImages) % totalImages;
        updateGallery(newIndex);
    });

    nextBtn?.addEventListener("click", () => {
        const newIndex = (currentIndex + 1) % totalImages;
        updateGallery(newIndex);
    });
</script>
