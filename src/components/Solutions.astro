---
import { ArrowUpRight, ArrowRight } from "lucide-astro";
import solarLightImg from "../assets/27f73711b1c3be77cf50c8cc0f5b04b01e089b1b.png";
import { supabase } from "../lib/supabase";

// Fetch 3 categories from Supabase
const { data: dbCategories, error } = await supabase
    .from("product_categories")
    .select("id, name, title, description")
    .limit(3);

if (error) {
    console.error("Error fetching categories for Solutions:", error);
}

const categories = (dbCategories || []).map((cat, index) => ({
    id: cat.id,
    title: cat.title || cat.name,
    category: cat.name,
    description:
        cat.description ||
        "Solución de iluminación solar de alta eficiencia con tecnología LED avanzada y panel fotovoltaico integrado.",
    image: solarLightImg.src, // Keep current image as requested
    tag: index === 0 ? "Best Seller" : index === 1 ? "Nuevo" : "Pro",
}));
---

<section class="lg:py-24 py-16 bg-[#111111] text-white">
    <div class="container mx-auto px-6">
        <div
            class="flex flex-col md:flex-row md:items-end justify-between md:mb-10 mb-8 lg:mb-16"
        >
            <div>
                <h3
                    class="text-orange-500 font-bold tracking-widest text-sm mb-2 uppercase"
                >
                    Nuestras Soluciones
                </h3>
                <h2
                    class="text-4xl lg:text-6xl font-bold uppercase tracking-tighter"
                >
                    Innovación en<br />Iluminación
                </h2>
            </div>
            <p class="text-gray-400 max-w-md mt-6 md:mt-0 md:pl-10 lg:pl-0">
                Tecnología solar de última generación para alumbrado público,
                residencial y comercial.
            </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            {
                categories.map((product, index) => (
                    <div
                        class="solution-card group relative bg-[#1a1a1a] border border-gray-800 hover:border-gray-600 transition-colors duration-300 overflow-hidden opacity-0 translate-y-8 transition-all duration-700 ease-out"
                        style={`transition-delay: ${index * 100}ms`}
                    >
                        {/* Image Container */}
                        <div class="aspect-square w-full overflow-hidden relative bg-white/5">
                            <img
                                src={product.image}
                                alt={product.title}
                                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 opacity-90 group-hover:opacity-100"
                            />
                            <div class="absolute top-4 right-4 bg-white text-black text-xs font-bold px-2 py-1 uppercase tracking-wider rounded-full z-10">
                                {product.tag}
                            </div>
                        </div>

                        {/* Content */}
                        <div class="p-8 relative">
                            <p class="text-orange-500 md:text-[11px] lg:text-xs text-xs font-bold tracking-wider uppercase mb-2">
                                {product.category}
                            </p>
                            <h3 class="md:text-lg lg:text-2xl text-2xl font-bold leading-tight md:mb-1 lg:mb-3 mb-3 group-hover:text-white transition-colors">
                                {product.title}
                            </h3>

                            <p class="text-gray-400 text-sm leading-relaxed mb-4 md:hidden lg:block block">
                                {product.description}
                            </p>

                            <a
                                href={`/productos#category-${product.id}`}
                                class="md:text-zinc-400 lg:text-[#FF8351] inline-flex items-center gap-2 text-[#FF8351] hover:text-[#ff6a31] transition-colors text-xs font-bold uppercase tracking-wider group/btn"
                            >
                                Ver Detalles
                                <ArrowUpRight class="w-4 h-4 group-hover/btn:translate-x-0.5 group-hover/btn:-translate-y-0.5 transition-transform" />
                            </a>
                        </div>
                    </div>
                ))
            }
        </div>

        {/* Bottom CTA */}
        <div class="md:mt-10 mt-12 lg:mt-12">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="text-zinc-600 text-md pb-5 md:pb-0">
                    Descubre nuestra línea completa de productos
                </div>
                <a
                    href="/productos"
                    class="text-zinc-600 hover:text-zinc-400 font-bold text-sm uppercase tracking-wider transition-colors flex items-center gap-2 group"
                >
                    Ver Todo El Catálogo
                    <ArrowRight
                        class="w-4 h-4 group-hover:translate-x-1 transition-transform"
                    />
                </a>
            </div>
        </div>
    </div>
</section>

<script>
    const observerOptions = {
        root: null,
        rootMargin: "0px",
        threshold: 0.1,
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
            if (entry.isIntersecting) {
                entry.target.classList.remove("opacity-0", "translate-y-8");
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);

    document.querySelectorAll(".solution-card").forEach((card) => {
        observer.observe(card);
    });
</script>
