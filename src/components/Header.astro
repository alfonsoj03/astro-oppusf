---
import { Menu, X, ArrowRight, ShoppingBag, Search } from "lucide-astro";
import oppluxLogo from "../assets/258df82474b849b69ecba8069ce145ec98c5d6b4.png";

interface Props {
    theme?: "transparent" | "black";
}

const { theme = "transparent" } = Astro.props;

const isBlackTheme = theme === "black";
---

<header
    id="main-header"
    class:list={[
        "fixed top-0 left-0 right-0 z-50 transition-all duration-300",
        isBlackTheme
            ? "bg-black py-4 border-b border-gray-800"
            : "bg-transparent py-6",
    ]}
    data-theme={theme}
>
    <div class="container mx-auto px-6 flex items-center justify-between">
        {/* Logo */}
        <a href="/" class="flex items-center gap-2">
            <img
                src={oppluxLogo.src}
                alt="Opplux"
                id="header-logo"
                class:list={[
                    "h-10 w-auto object-contain transition-all duration-300",
                    isBlackTheme ? "" : "brightness-200 contrast-100",
                ]}
            />
        </a>

        {/* Desktop Nav */}
        <nav class="hidden md:flex items-center gap-8">
            <a
                href="/"
                class:list={[
                    "text-sm font-medium transition-colors uppercase tracking-wider nav-link",
                    isBlackTheme
                        ? "text-white hover:text-gray-300"
                        : "text-white/80 hover:text-white",
                ]}
            >
                Inicio
            </a>
            <a
                href="/nosotros"
                class:list={[
                    "text-sm font-medium transition-colors uppercase tracking-wider nav-link",
                    isBlackTheme
                        ? "text-white hover:text-gray-300"
                        : "text-white/80 hover:text-white",
                ]}
            >
                Nosotros
            </a>
            <a
                href="/productos"
                class:list={[
                    "text-sm font-medium transition-colors uppercase tracking-wider nav-link",
                    isBlackTheme
                        ? "text-white hover:text-gray-300"
                        : "text-white/80 hover:text-white",
                ]}
            >
                Productos
            </a>
            <a
                href="#"
                class:list={[
                    "text-sm font-medium transition-colors uppercase tracking-wider nav-link",
                    isBlackTheme
                        ? "text-white hover:text-gray-300"
                        : "text-white/80 hover:text-white",
                ]}
            >
                Soporte
            </a>
        </nav>

        {/* Actions */}
        <div class="hidden md:flex items-center gap-4">
            <button
                id="search-btn"
                class:list={[
                    "p-2 rounded-full transition-colors",
                    isBlackTheme
                        ? "hover:bg-gray-800 text-white"
                        : "hover:bg-white/10 text-white",
                ]}
            >
                <Search class="w-5 h-5" />
            </button>
            <button
                id="cta-btn"
                class:list={[
                    "flex items-center gap-2 px-5 py-2 rounded-full text-sm font-bold transition-colors",
                    isBlackTheme
                        ? "bg-white text-black hover:bg-gray-200"
                        : "bg-white text-black hover:bg-gray-200",
                ]}
            >
                Cotizar Ahora
                <ArrowRight class="w-4 h-4" />
            </button>
        </div>

        {/* Mobile Menu Toggle */}
        <button
            id="mobile-menu-btn"
            class:list={[
                "md:hidden p-2",
                isBlackTheme ? "text-white" : "text-white",
            ]}
        >
            <Menu id="menu-icon" />
            <X id="close-icon" class="hidden" />
        </button>
    </div>

    {/* Mobile Nav */}
    <div
        id="mobile-menu"
        class="md:hidden bg-white border-b border-gray-200 overflow-hidden h-0 transition-all duration-300"
    >
        <nav class="flex flex-col p-6 gap-4">
            <a href="/" class="text-lg font-bold text-gray-900 mobile-link"
                >Inicio</a
            >
            <a
                href="/nosotros"
                class="text-lg font-bold text-gray-900 mobile-link">Nosotros</a
            >
            <a
                href="/productos"
                class="text-lg font-bold text-gray-900 mobile-link">Productos</a
            >
            <a href="#" class="text-lg font-bold text-gray-900 mobile-link"
                >Soporte</a
            >
            <button
                class="mt-4 w-full bg-black text-white py-3 rounded-full font-bold"
            >
                Cotizar Ahora
            </button>
        </nav>
    </div>
</header>

<script>
    const header = document.getElementById("main-header");
    const logo = document.getElementById("header-logo");
    const navLinks = document.querySelectorAll(".nav-link");
    const searchBtn = document.getElementById("search-btn");
    const ctaBtn = document.getElementById("cta-btn");
    const mobileMenuBtn = document.getElementById("mobile-menu-btn");
    const mobileMenu = document.getElementById("mobile-menu");
    const menuIcon = document.getElementById("menu-icon");
    const closeIcon = document.getElementById("close-icon");

    const initialTheme = header?.dataset.theme || "transparent";

    function updateHeaderStyle() {
        if (!header || initialTheme === "black") return;

        const isScrolled = window.scrollY > 50;

        if (isScrolled) {
            header.classList.remove("bg-transparent", "py-6");
            header.classList.add(
                "bg-white/80",
                "backdrop-blur-md",
                "py-4",
                "border-b",
                "border-gray-200",
            );

            logo?.classList.remove("brightness-200", "contrast-100");

            navLinks.forEach((link) => {
                link.classList.remove("text-white/80", "hover:text-white");
                link.classList.add("text-gray-600", "hover:text-black");
            });

            searchBtn?.classList.remove("hover:bg-white/10", "text-white");
            searchBtn?.classList.add("hover:bg-gray-100", "text-black");

            ctaBtn?.classList.remove(
                "bg-white",
                "text-black",
                "hover:bg-gray-200",
            );
            ctaBtn?.classList.add(
                "bg-black",
                "text-white",
                "hover:bg-gray-800",
            );

            if (mobileMenuBtn) {
                mobileMenuBtn.classList.remove("text-white");
                mobileMenuBtn.classList.add("text-black");
            }
        } else {
            header.classList.add("bg-transparent", "py-6");
            header.classList.remove(
                "bg-white/80",
                "backdrop-blur-md",
                "py-4",
                "border-b",
                "border-gray-200",
            );

            logo?.classList.add("brightness-200", "contrast-100");

            navLinks.forEach((link) => {
                link.classList.add("text-white/80", "hover:text-white");
                link.classList.remove("text-gray-600", "hover:text-black");
            });

            searchBtn?.classList.add("hover:bg-white/10", "text-white");
            searchBtn?.classList.remove("hover:bg-gray-100", "text-black");

            ctaBtn?.classList.add(
                "bg-white",
                "text-black",
                "hover:bg-gray-200",
            );
            ctaBtn?.classList.remove(
                "bg-black",
                "text-white",
                "hover:bg-gray-800",
            );

            if (mobileMenuBtn) {
                mobileMenuBtn.classList.add("text-white");
                mobileMenuBtn.classList.remove("text-black");
            }
        }
    }

    // Scroll Event
    if (initialTheme === "transparent") {
        window.addEventListener("scroll", updateHeaderStyle);
        // Initial check
        updateHeaderStyle();
    }

    // Mobile Menu Toggle
    mobileMenuBtn?.addEventListener("click", () => {
        const isOpen = mobileMenu?.style.height === "auto";

        if (isOpen) {
            if (mobileMenu) mobileMenu.style.height = "0";
            menuIcon?.classList.remove("hidden");
            closeIcon?.classList.add("hidden");
        } else {
            if (mobileMenu) mobileMenu.style.height = "auto";
            menuIcon?.classList.add("hidden");
            closeIcon?.classList.remove("hidden");
        }
    });

    // Close mobile menu on link click
    const mobileLinks = document.querySelectorAll(".mobile-link");
    mobileLinks.forEach((link) => {
        link.addEventListener("click", () => {
            if (mobileMenu) mobileMenu.style.height = "0";
            menuIcon?.classList.remove("hidden");
            closeIcon?.classList.add("hidden");
        });
    });
</script>
